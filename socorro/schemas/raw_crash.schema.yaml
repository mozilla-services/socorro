# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

# Adding a new crash annotation to the raw crash schema?
# https://github.com/mozilla-services/socorro/tree/main/socorro/schemas

---
$schema: moz://mozilla.org/schemas/socorro/socorro-data/1-0-0
type: object

default_permissions: ["public", "protected"]

properties:
  metadata:
    pattern_properties:
      ^.+$:
        description: Field generated by the collector at ingestion.
        type: ["any"]
        permissions: ["protected"]
    description: >
      Collector meta data.
    type: object
    permissions: ["protected"]

  submitted_timestamp:
    description: |
      Date when the crash report was accepted by the collector in ISO-8601
      format UTC.

      Added by the collector.
    type: string
    permissions: ["public"]

  uuid:
    description: |
      Crash id generated by the collector at ingestion. The last 6 characters
      are in the form of YYMMDD for the date the crash report was accepted.

      Added by the collector.
    type: string
    permissions: ["public"]

  version:
    description: >
      Version of the raw crash structure this item was encoded with.

      Added by the collector.
    type: integer
    permissions: ["public"]

  # This lists crash annotations that Socorro knows about and details about
  # them.
  #
  # Crash annotations being emitted by crash reporters should be documented in:
  #
  # https://searchfox.org/mozilla-central/source/toolkit/crashreporter/CrashAnnotations.yaml
  #
  # This file additionally specifies permissions required to see the data,
  # data_review urls, related bugs, and example data.

  # AnnotationName:
  #   description: some description here
  #   type: string
  #   permissions: ["protected"]
  #   data_review:
  #     - url
  #   bugs:
  #     - url
  #   examples: ["xxx", "yyy"]

  AbortMessage:
    description: >
      Message passed to NS_DebugBreak().
    type: string
    permissions: ["public"]

  Accessibility:
    description: >
      Set to "Active" by the accessibility service when it is active.
    type: string
    permissions: ["public"]

  AccessibilityClient:
    description: >
      Accessibility client ID.
    type: string
    permissions: ["public"]

  AccessibilityInProcClient:
    description: >
      Hexadecimal mask of in-process accessibility consumers, see
      accessible/windows/msaa/Compatibility.h for the mappings.
    type: string
    permissions: ["public"]

  AdapterDeviceID:
    description: >
      Graphics adapter name.
    type: string
    permissions: ["public"]

  AdapterDriverVersion:
    description: >
      Graphics adapter driver version.
    type: string
    permissions: ["public"]

  AdapterSubsysID:
    description: >
      Graphics adapter subsystem ID.
    type: string
    permissions: ["public"]

  AdapterVendorID:
    description: >
      Graphics adapter vendor name.
    type: string
    permissions: ["public"]

  Add-ons:
    description: >
      List of currently enabled add-ons.
    type: string
    permissions: ["public"]

  additional_minidumps:
    description: >
      Comma separated list of additional minidumps for this crash, each element
      in the list represent the suffix used in the dump filename. E.g. the
      "browser" entry for crash fa909194-737b-4b93-b8da-da110ac785e0 implies the
      existence of the fa909194-737b-4b93-b8da-da110ac785e0-browser.dmp file.
    type: string
    permissions: ["protected"]

  Android_Board:
    description: >
      The board used by the Android device.
    type: string
    permissions: ["public"]

  Android_Brand:
    description: >
      The Android device brand.
    type: string
    permissions: ["public"]

  Android_CPU_ABI:
    description: >
      The Android primary CPU ABI being used.
    type: string
    permissions: ["public"]

  Android_CPU_ABI2:
    description: >
      The Android secondary CPU ABI being used.
    type: string
    permissions: ["public"]

  Android_Device:
    description: >
      The Android device name.
    type: string
    permissions: ["public"]

  Android_Display:
    description: >
      The Android display.
    type: string
    permissions: ["public"]

  Android_Fingerprint:
    description: >
      A string that uniquely identifies this build.
    type: string
    permissions: ["public"]

  Android_Hardware:
    description: >
      The Android device hardware.
    type: string
    permissions: ["public"]

  Android_Manufacturer:
    description: >
      The Android device manufacturer.
    type: string
    permissions: ["public"]

  Android_Model:
    description: >
      The Android device model name.
    type: string
    permissions: ["public"]

  Android_Version:
    description: >
      The Android version.
    type: string
    permissions: ["public"]

  AppInitDLLs:
    description: >
      List of DLLs loaded when launching any application on Windows. This
      reflects the contents of the AppInit_DLLs registry key.
    type: string
    permissions: ["public"]

  ApplicationBuildID:
    description: >
      Product application's build ID.
    type: string
    permissions: ["public"]

  AsyncShutdownTimeout:
    description: >
      This annotation is present if a shutdown blocker was not released in time
      and the browser was crashed instead of waiting for shutdown to finish. The
      condition that caused the hang is contained in the annotation.
    type: string
    permissions: ["public"]

  AvailablePageFile:
    description: |
      Available commit-space in bytes.
      - Under Windows, computed from the PERFORMANCE_INFORMATION structure by
        substracting the CommitTotal field from the CommitLimit field.
      - Under Linux, computed from /proc/meminfo's CommitLimit - Committed_AS.
        Note that the kernel is not guaranteed to enforce that CommittedLimit
        >= Committed_AS. If Committed_AS > CommittedLimit, this value is set to
        0.
      - Not available on other platforms.
    type: string
    permissions: ["public"]

  AvailablePhysicalMemory:
    description: |
      Amount of free physical memory in bytes.
      - Under Windows, populated with the contents of the MEMORYSTATUSEX's
        structure ullAvailPhys field.
      - Under macOS, populated with vm_statistics64_data_t::free_count.
      - Under Linux, populated with /proc/meminfo's MemFree.
      - Not available on other platforms.
    type: string
    permissions: ["public"]

  AvailableVirtualMemory:
    description: |
      Amount of free virtual memory in bytes
      - Under Windows, populated with the contents of the MEMORYSTATUSEX's
        structure ullAvailVirtual field.
      - Under Linux, populated with /proc/meminfo's MemAvailable.
      - Not available on other platforms.
      - For macOS, see AvailableSwapMemory, AvailablePhysicalMemory and
        PurgeablePhysicalMemory.
    type: string
    permissions: ["public"]

  Breadcrumbs:
    description: >
      Trail of events that occurred before a report. this will consist of
      multiple breadcrumbs with timestamp, message, category, level, type and
      data in JSON format.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1671276
    type: string
    permissions: ["protected"]

  BuildID:
    description: >
      The unique build identifier of this version which is typically a
      timestamp of the form YYYYMMDDHHMMSS.
    type: string
    permissions: ["public"]

  Comments:
    description: >
      Comments from the user at the time of the crash.
    type: string
    permissions: ["protected"]

  CoMarshalInterfaceFailure:
    description: >
      Annotation describing the error returned by trying to marshal an object
      via CoMarshalInterface during the creation of an IPC proxy stream.
    type: string
    permissions: ["public"]

  CoUnmarshalInterfaceResult:
    description: >
      Annotation describing the error returned by trying to unmarshal an object
      via CoUnmarshalInterface during the creation of an IPC proxy stream.
    type: string
    permissions: ["public"]

  ContentSandboxCapabilities:
    description: >
      List of capabilities of the content process sandbox.
    type: string
    permissions: ["public"]

  ContentSandboxCapable:
    description: >
      Set to 1 if the client is capable of content sandboxing.
    type: string
    permissions: ["public"]

  ContentSandboxEnabled:
    description: >
      Set to 1 when content process sandboxing is enabled.
    type: string
    permissions: ["public"]

  ContentSandboxLevel:
    description: >
      Content sandbox level.
    type: string
    permissions: ["public"]

  CPUMicrocodeVersion:
    description: >
      Version of the CPU microcode.
    type: string
    permissions: ["public"]

  CrashTime:
    description: >
      Crash time in seconds since the Epoch.
    type: string
    permissions: ["public"]

  DistributionID:
    description: >
      Product application's distribution ID.
    type: string
    permissions: ["public"]

  DOMFissionEnabled:
    description: >
      Set to 1 when DOM fission is enabled, and subframes are potentially loaded
      in a separate process.
    type: string
    permissions: ["public"]

  DOMIPCEnabled:
    description: >
      Set to 1 when a tab is running in a content process
    type: string
    permissions: ["public"]

  DumperError:
    description: >
      Error message of the minidump writer, in case there was an error during
      dumping.
    type: string
    permissions: ["protected"]

  EMCheckCompatibility:
    description: >
      Set to 1 if add-on compatibility checking is enabled.
    type: string
    permissions: ["public"]

  GMPLibraryPath:
    description: >
      Holds the path to the GMP plugin library.
    type: string
    permissions: ["protected"]

  GMPPlugin:
    description: >
      Set to 1 if the GMP plugin is enabled.
    type: string
    permissions: ["public"]

  GraphicsCriticalError:
    description: >
      Information of a critical error that occurred within the graphics code.
    type: string
    permissions: ["public"]

  GraphicsStartupTest:
    description: >
      Set to 1 by the graphics driver crash guard when it's activated.
    type: string
    permissions: ["public"]

  HasDeviceTouchScreen:
    description: >
      Set to 1 if the device had a touch-screen, this only applies to Firefox
      desktop as on mobile devices we assume a touch-screen is always present.
    type: string
    permissions: ["public"]

  InstallTime:
    description: >
      The time when Firefox was installed expressed as seconds since the Epoch
    type: string
    permissions: ["public"]

  ipc_channel_error:
    description: >
      Set before a content process crashes because of an IPC channel error,
      holds a description of the error.
    type: string
    permissions: ["public"]

  IPCFatalErrorMsg:
    description: >
      Describes a fatal error that occurred during IPC operation.
    type: string
    permissions: ["public"]

  IPCFatalErrorProtocol:
    description: >
      Name of the protocol used by IPC when a fatal error occurred.
    type: string
    permissions: ["public"]

  IPCMessageName:
    description: >
      Name of the IPC message that caused a crash because it was too large.
    type: string
    permissions: ["public"]

  IPCMessageSize:
    description: >
      Size of the IPC message that caused a crash because it was too large.
    type: string
    permissions: ["public"]

  IPCShutdownState:
    description: >
      IPC shutdown state, can be set to either 'RecvShutdown' or
      'SendFinishShutdown' by a content process while it's shutting down.
    type: string
    permissions: ["public"]

  IPCSystemError:
    description: >
      Description of the last system error that occurred during IPC operation.
    type: string
    permissions: ["public"]

  IsGarbageCollecting:
    description: >
      If true then the JavaScript garbage collector was running when the crash
      occurred.
    type: string
    permissions: ["public"]

  JavaException:
    description: |
      JSON structured Java stack trace, only present on Firefox for Android if
      we encounter an uncaught Java exception.

      Parts of the JSON structure can contain sensitive data.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1675560
    type: string
    permissions: ["protected"]

  JavaStackTrace:
    description: |
      Java stack trace, only present on Firefox for Android if we encounter an
      uncaught Java exception. This is an unstructured string.

      Parts of the string can contain sensitive data.
    type: string
    permissions: ["protected"]

  MacAvailableMemorySysctl:
    description: >
      The value of the available memory sysctl 'kern.memorystatus_level'.
      Expected to be a percentage integer value.
    type: string
    permissions: ["public"]

  MacMemoryPressure:
    description: >
      The current memory pressure state as provided by the macOS memory
      pressure dispatch source. The annotation value is one of 'Normal' for no
      memory pressure, 'Unset' indicating a memory pressure event has not been
      received, 'Warning' or 'Critical' mapping to the system memory pressure
      levels, or 'Unexpected' for an unexpected level. This is a Mac-specific
      annotation.
    type: string
    permissions: ["public"]

  MacMemoryPressureCriticalTime:
    description: >
      The time when the memory pressure state last transitioned to 'Critical'
      expressed as seconds since the Epoch.
    type: string
    permissions: ["public"]

  MacMemoryPressureNormalTime:
    description: >
      The time when the memory pressure state last transitioned to 'Normal'
      expressed as seconds since the Epoch.
    type: string
    permissions: ["public"]

  MacMemoryPressureSysctl:
    description: >
      The value of the memory pressure sysctl
      'kern.memorystatus_vm_pressure_level'. Indicates which memory pressure
      level the system is in at the time of the crash. The expected values are
      one of 4 (Critical), 2 (Warning), or 1 (Normal).
    type: string
    permissions: ["public"]

  MacMemoryPressureWarningTime:
    description: >
      The time when the memory pressure state last transitioned to 'Warning'
      expressed as seconds since the Epoch.
    type: string
    permissions: ["public"]

  ModuleSignatureInfo:
    description: Module signature information.
    type: string
    permissions: ["protected"]

  MozCrashReason:
    description: |
      Plaintext description of why Firefox crashed, this is usually set by
      assertions and the like.

      This can contain sensitive data.
    type: string
    permissions: ["protected"]

  Notes:
    description: |
      Miscellaneous notes that can be appended to a crash. Mostly contains
      graphics related notes.
    type: string
    permissions: ["public"]

  OOMAllocationSize:
    description: >
      Size of the allocation that caused an out-of-memory condition.
    type: string
    permissions: ["public"]

  PHCAllocStack:
    description: >
      The allocation's allocation stack trace, if the crash involved a bad
      access of a special PHC allocation. Encoded as a comma-separated list of
      decimal addresses.
    type: string
    permissions: ["protected"]

  PHCBaseAddress:
    description: >
      The allocation's base address, if the crash involved a bad access of a
      special PHC allocation. Encoded as a decimal address.
    type: string
    permissions: ["protected"]

  PHCFreeStack:
    description: >
      The allocation's free stack trace, if the crash involved a bad access
      of a special PHC allocation. Encoded as a comma-separated list of decimal
      addresses.
    type: string
    permissions: ["protected"]

  PHCKind:
    description: >
      The allocation kind, if the crash involved a bad access of a special PHC
      allocation.
    type: string
    permissions: ["protected"]

  PHCUsableSize:
    description: >
      The allocation's usable size, if the crash involved a bad access of a
      special PHC allocation.
    type: string
    permissions: ["protected"]

  PluginFilename:
    description: >
      Plugin filename, only the process holding the plugin has this annotation.
    type: string
    permissions: ["public"]

  PluginName:
    description: >
      Display name of a plugin, only the process holding the plugin has this
      annotation.
    type: string
    permissions: ["public"]

  PluginVersion:
    description: >
      Version of a plugin, only the process holding the plugin has this
      annotation.
    type: string
    permissions: ["public"]

  ProcessType:
    description: >
      Type of the process that crashed, the possible values are defined in
      GeckoProcessTypes.h.
    type: string
    permissions: ["public"]

  ProductID:
    description: >
      Application UUID (e.g. ec8030f7-c20a-464f-9b0e-13a3a9e97384).
    type: string
    permissions: ["public"]

  ProductName:
    description: >
      Application name (e.g. Firefox).
    type: string
    permissions: ["public"]

  ReleaseChannel:
    description: >
      The update channel that the product is on. Typically 'nightly', 'aurora',
      'beta', 'release', or 'esr'. This may also be other values like
      'release-cck-partner'.
    type: string
    permissions: ["public"]

  RemoteType:
    description: >
      Type of the content process, can be set to "web", "file" or "extension".
    type: string
    permissions: ["protected"]

  SafeMode:
    description: >
      Set to 1 if the browser was started in safe mode.
    type: string
    permissions: ["public"]

  SecondsSinceLastCrash:
    description: >
      Time in seconds since the last crash occurred.
    type: string
    permissions: ["public"]

  ShutdownProgress:
    description: >
      Shutdown step at which the browser crashed, can be set to
      'quit-application', 'profile-change-teardown', 'profile-before-change',
      'xpcom-will-shutdown' or 'xpcom-shutdown'.
    type: string
    permissions: ["public"]

  StartupCrash:
    description: >
      If set to 1 then this crash occurred during startup.
    type: string
    permissions: ["public"]

  StartupTime:
    description: >
      The time when Firefox was launched expressed in seconds since the Epoch.
    type: string
    permissions: ["public"]

  SubmittedFrom:
    description: |
      This annotation can hold one of the following five values depending on how
      this crash was submitted by the user:
      - Auto: the user had opted-in to auto-submission
      - Infobar: the user clicked on the infobar to submit the crash
      - AboutCrashes: the user sent the crash from the about:crashes page
      - CrashedTab: the user sent the crash from a crashed tab page
      - Client: the user sent the crash using the crash reporter client
    type: string
    permissions: ["public"]

  SubmittedFromInfobar:
    description: >
      Whether or not it was submitted from the infobar.

      Deprecated in favor of SubmittedFrom. Remove in 2023.
    deprecated: true
    type: string
    permissions: ["public"]

  SystemMemoryUsePercentage:
    description: >
      Windows-only, percentage of physical memory in use. This annotation is
      populated with the contents of the MEMORYSTATUSEX's structure
      dwMemoryLoad field.
    type: string
    permissions: ["public"]

  TelemetryEnvironment:
    description: >
      The telemetry environment in JSON format.
    type: string
    permissions: ["public"]

  Throttleable:
    description: >
      Whether Socorro can selectively discard this crash report or not. If set
      to "0" the crash report will always be processed by Socorro. Do not set
      this annotation within Gecko code, it's only supposed to be used by the
      crash reporting machinery.
    type: string
    permissions: ["public"]

  TotalPageFile:
    description: |
      Maximum amount of memory that can be committed without extending the
      swap/page file.
      - Under Windows, populated with the contents of the
        PERFORMANCE_INFORMATION's structure CommitLimit field.
      - Under Linux, populated with /proc/meminfo MemTotal + SwapTotal. The
        swap file typically cannot be extended, so that's a hard limit.
      - Not available on other systems.
    type: string
    permissions: ["public"]

  TotalPhysicalMemory:
    description: |
      Amount of physical memory in bytes.
      - Under Windows, populated with the contents of the MEMORYSTATUSEX's
        structure ullTotalPhys field.
      - Under macOS, populated with sysctl "hw.memsize".
      - Under Linux, populated with /proc/meminfo's "MemTotal".
      - Not available on other systems.
    type: string
    permissions: ["public"]

  TotalVirtualMemory:
    description: |
      Size of the virtual address space.
      - Under Windows, populated with the contents of the MEMORYSTATUSEX's
        structure ullTotalVirtual field.
      - Not available on other platforms.
    type: string
    permissions: ["public"]

  UptimeTS:
    description: >
      Uptime in seconds. This annotation uses a string instead of an integer
      because it has a fractional component.
    type: string
    permissions: ["public"]

  URL:
    description: >
      URL being loaded.
    type: string
    permissions: ["protected"]

  useragent_locale:
    description: >
      User-agent locale.
    type: string
    permissions: ["public"]

  UtilityProcessSandboxingKind:
    description: >
      The SandboxingKind passed for this Utility process instance
    type: string
    permissions: ["public"]

  Vendor:
    description: >
      Application vendor (e.g. Mozilla).
    type: string
    permissions: ["public"]

  Version:
    description: >
      The product version number. For Firefox versions, a value lacking letters
      indicates a normal release; a value with 'b' indicates a beta release; a
      value with 'a' indicates aurora release; and a value with 'esr' indicates
      an Extended Service Release.
    type: string
    permissions: ["public"]

  WindowsErrorReporting:
    description: >
      Set to 1 if this crash was intercepted via the Windows Error Reporting
      runtime exception module.
    type: string
    permissions: ["public"]

  Winsock_LSP:
    description: >
      Information on winsock LSPs injected in our networking stack.
    type: string
    permissions: ["public"]

  XPCOMSpinEventLoopStack:
    description: >
      If we crash while some code is spinning manually the event loop on the
      main thread, we will see the stack of nested annotations here.
      If the crashing process was killed (e.g. due to an IPC error), this
      annotation may refer to the parent process that killed it, look out for
      the prefix ("default" means parent) and see bug 1741131 for details.
    bugs:
      - https://bugzilla.mozilla.org/show_bug.cgi?id=1741131
    type: string
    permissions: ["public"]
