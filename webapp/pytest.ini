# pytest configuration for running webapp tests
[pytest]
# -rsxX        - show skipped, failed, and passed tests
# --tb=native  - print native traceback
addopts = -rsxX --tb=native

env =
    DJANGO_SETTINGS_MODULE=crashstats.settings.test

# Transform all warnings into errors
filterwarnings =
    error
    # some django tests kick up unclosed file warning for favicon
    # https://bugzilla.mozilla.org/show_bug.cgi?id=1909011
    ignore:unclosed file <_io.BufferedReader name='/app/webapp/crashstats/crashstats/static/img/favicon.ico':ResourceWarning
    ignore:unclosed file <_io.FileIO name='/app/webapp/crashstats/crashstats/static/img/favicon.ico':ResourceWarning
    # NOTE(bdanforth) The new log_actions method in Django 6.0 no longer
    # has an object_repr parameter.
    # This means User.__str__() will be used, which is user.username
    # (a randomly generated string) instead of user.email. There are ways
    # around that, but we can deal with that in the next major upgrade.
    ignore:LogEntryManager\.log_action\(\) is deprecated:django.utils.deprecation.RemovedInDjango60Warning
